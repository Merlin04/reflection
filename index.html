<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Reflection bootstrapper</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <script type="module">
        import localforage from "./_localforage/localforage.jsm";

        void async function() {
            // Sometimes chrome will just ignore the service worker or not import the scripts the worker depends on
            // Often re-registering the worker is necessary, other times reloading is enough, but it's easier to always re-register it
            if((await localforage.keys()).length > 0) {
                await (await navigator.serviceWorker.getRegistrations())[0].unregister();
                await navigator.serviceWorker.register("/worker.jsm", { type: "module", scope: "/" });
                window.location.reload();
            }

            const image = (await import("/image.jsm")).default;
            let exports;
            eval(image["_loadESString.fragment.js"]);
            exports(image["_bootstrapEntrypoint.jsm"]).then(module => module.default(image));
        }();
    </script>
</head>
<body>
    <h1>Bootstrapping...</h1>
    <p>Not working? Try using Chrome</p>
</body>
</html>